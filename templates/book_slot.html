<!-- <html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
    <style>
        .seat {
            width: 50px;
            height: 30px;
            margin: 5px;
            text-align: center;
            line-height: 30px;
            border: 1px solid #ccc;
            display: inline-block;
        }

        .reserved {
            background-color: red;
            color: white;
        }
        label{
            font-size: large;
            font-weight: 400;
        
        }
        .form-label{
            color: black;
            font-weight: bold;
        }
        .container1 {
      border: 2px solid #ccc;
      padding: 20px;
      margin: 10px;
      cursor: pointer;
      width: 10%;
    }
    .container1.selected {
      border-color: blue;
    }
    </style>
</head>
<body>
    {% include 'header.html' %}

    
    
        <style>
            .time-slots {
                display: flex;
                flex-wrap: wrap;
            }
    
            .time-slot {
                border: 1px solid #ccc;
                margin: 5px;
                padding: 5px;
                cursor: pointer;
            }
    
            .time-slot.selected {
                background-color: rgb(43, 0, 255);
                color: white;
            }
            .time-slot.booked {
                background-color: rgb(255, 0, 0);
                color: white;
            }
        </style>
    
        <div class="container mt-5 mb-5">
            <h2>Time Slot Selection</h2>
            <div id="timeSlots" class="d-flex flex-wrap">
                    <p>{{ booked_data}}</p>
                    
                    {% for time_slot in time_slots %}
                    {% set is_booked = false %}
                    {% for book in booked_data %}
                        {% if time_slot == book.split[0] %}
                            {% set is_booked = true %}
                        {% endif %}
                    {% endfor %}
                    {% if is_booked %}
                        <div class="time-slot booked" data-time="{{ time_slot }}" onclick="toggleTimeSlot(this)">
                            {{ time_slot }}
                        </div>
                    {% else %}
                        <div class="time-slot" data-time="{{ time_slot }}" onclick="toggleTimeSlot(this)">
                            {{ time_slot }}
                        </div>
                    {% endif %}
                {% endfor %}

                
                

               
            </div>
        </div>
          <script>
             $(document).ready(function() {
    bookTimeSlots();
});

function bookTimeSlots() {
    // Loop through each time slot element
    $('.time-slot').each(function() {
        var timeSlot = $(this).data('time');
        var isBooked = false;

        // Loop through each booked time slot to check for overlap
        for (var i = 0; i < booked_data.length; i++) {
            var startSlot = booked_data[i][0];
            var endSlot = booked_data[i][1];

            // Check if the time slot overlaps with any booked time slot
            if (timeSlot >= startSlot && timeSlot <= endSlot) {
                isBooked = true;
                break;
            }
        }

        // If the time slot is booked, color it red, otherwise color it blue
        if (isBooked) {
            $(this).addClass('booked');
        } else {
            $(this).addClass('selected');
        }
    });

    calculateTotalHours();
}
          </script>

       
        
        
        
    
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script>
            
    
            var selectedTimeSlots = [];
            var selectedRange = 'N/A';
            var connectorTypePrice = 0;
            var totalMinutes = 0; // Declare totalMinutes globally
    
            function calculateTotalTime(startTime, endTime) {
                document.getElementById('bookings').style.display="block";
                var startParts = startTime.split(':');
                var startMinutes = parseInt(startParts[0]) * 60 + parseInt(startParts[1]);
                

                var endParts = endTime.split(':');
                var endMinutes = parseInt(endParts[0]) * 60 + parseInt(endParts[1]);
                

                totalMinutes = endMinutes - startMinutes; // Update the global variable
    
                var hours = Math.floor(totalMinutes / 60);
                var minutes = totalMinutes % 60;
                
                var total_min = (hours*60)+minutes;

                var selectedChargeLevel = document.querySelector('input[name="charge_level"]:checked').value;
                var totalcost = 0
                if (selectedChargeLevel == "Level 1"){
                    totalcost = total_min * 1;
                }
                else if(selectedChargeLevel == "Level 2"){
                    totalcost = total_min * 2;
                }
                else{
                    totalcost = total_min * 3;
                }



                
                document.getElementById("totalCost").innerHTML = totalcost + '  INR';
                document.getElementById('total_cost').value=totalcost;
                document.getElementById('totalHours').innerText = 'Total Hours: ' + hours + ' hours ' + minutes + ' minutes';
    
                return hours + ' hours ' + minutes + ' minutes';
            }
    
            function toggleTimeSlot(element) {
                var timeSlot = element.getAttribute('data-time');
    
                if (selectedTimeSlots.length === 0) {
                    selectedTimeSlots.push(timeSlot);
                    connectorTypePrice = parseFloat(element.getAttribute('data-price'));
                    $(element).addClass('selected');
                } else if (selectedTimeSlots.length === 1) {
                    var startSlot = selectedTimeSlots[0];
                    var endSlot = timeSlot;
    
                    $('.time-slot').removeClass('selected');
    
                    var startIndex = $('#timeSlots .time-slot[data-time="' + startSlot + '"]').index();
                    var endIndex = $('#timeSlots .time-slot[data-time="' + endSlot + '"]').index();
    
                    for (var i = Math.min(startIndex, endIndex)-1; i < Math.max(startIndex, endIndex); i++) {
                        $('#timeSlots .time-slot').eq(i).addClass('selected');
                    }
    
                    selectedTimeSlots.push(timeSlot);
                } else {
                    selectedTimeSlots = [];
                    $('.time-slot').removeClass('selected');
                }
    
                calculateTotalHours();
            }
    
            function calculateTotalHours() {
                if (selectedTimeSlots.length > 0) {
                    var startRange = selectedTimeSlots[0].split(' - ')[0];
                    var endRange = selectedTimeSlots[selectedTimeSlots.length - 1].split(' - ')[1];
                    
                    var start = selectedTimeSlots[0]
                    var end   = selectedTimeSlots[selectedTimeSlots.length - 1]
                    document.getElementById('start_time').value= start;
                    document.getElementById('end_time').value= end;
                    selectedRange = startRange + ' - ' + endRange;
                } else {
                    selectedRange = 'N/A';
                }
                document.getElementById('selectedRange').innerText = 'Selected Range: ' + selectedRange;
    
                var timeParts = selectedRange.split(' - ');
                var startTime = timeParts[0].trim();
                var endTime = timeParts[1].trim();
    
                var totalTime = calculateTotalTime(startTime, endTime);
                document.getElementById('totalTime').value=totalTime;
    
                
            }

            

        </script>
    </div>
    

    <div class="container">
        <table id="bookings" style="display: none;" class="table table-dark table-striped">
            <thead>
              
                    <th>Total Hours</th>
                    <th>Selected Range</th>
                    <th>Total Cost</th>
                
            </thead>
            <tbody>
               
                    <td><span id="totalHours"></span></td>
                    <td><span id="selectedRange"></span></td>
                    <td><span id="totalCost"></span></td>
                    <td><form action="{{url_for('book_port',company_id=company_id)}}" method="post" id="bookings">
                        <input type="text" name="start_time" id="start_time"  >
                        <input type="text" name="end_time" id="end_time"  >
                        <input type="text" name="total_cost" id="total_cost"  hidden>
                        <input type="text" name="totalTime" id="totalTime" hidden>
                        <input  id="selectedContainer" name="selectedport" value="" hidden>
                        <input type="text" id="selectedConnectorType" name="selectedConnectorType" hidden>
                        <input type="text" id="selectedChargeLevel" name="selectedChargeLevel" hidden>
                        <button name="submit" value="submit" type="submit"  class="btn btn-danger btn-block btn-flat">Submit</button>
                    </form></td>
               
            </tbody>
        </table>
    </div>
    
    
    



    

</body>
</html> -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">
    <style>
        .time-slot {
            width: 50px;
            height: 30px;
            margin: 5px;
            text-align: center;
            line-height: 30px;
            border: 1px solid #ccc;
            display: inline-block;
        }

        
        label{
            font-size: large;
            font-weight: 400;
        }
        .form-label{
            color: black;
            font-weight: bold;
        }
        
    </style>

    

    
   
<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Slots</title> -->
    <style>
        .time-slot {
            width: 100px;
            height: 30px;
            margin: 5px;
            text-align: center;
            line-height: 30px;
            border: 1px solid #ccc;
            display: inline-block;
            font-size: small;
        }
        .available{
            background-color: rgb(0, 136, 0);
            color: aliceblue;
        }
        .booked {
            background-color: red;
        }
        .selected {
            background-color: blue;
            color: white;
        }
    </style>
</head>
<body>
    {% include 'header.html' %}
    <h2 class="text-center">Select the Slot :</h2>
    <div id="timeSlotsContainer" class="container"></div>
    <div id="selectedSlots" style="display: none;"></div>
    <div>
        <!-- Start Slot: <input type="text" id="startSlot" readonly><br>
        End Slot: <input type="text" id="endSlot" readonly>
        cost : <input type="text" id="totalCost" readonly>
        total time: <input type="text" id="totalHours" readonly> -->

    </div>
    <div class="container">
        <table id="bookings"  class="table table-dark table-striped table-responsive">
            <thead>
                    <th>Selected Port</th>
                    <th>Selected Type</th>
                    <th>Selected Level</th>
                    <th>Selected Range</th>
                    <th>Total Cost</th>
                    <th>Total Hours</th>

                
            </thead>
            <tbody>
                    <td>Selected Port is {{ selectedport }}</td>
                    <td>Selected Type is {{ selectedtype }}</td>
                    <td>Selected level is {{ selectedlevel }}</td>
                    <td><span id="selected_Range"></span></td>
                    <td><span id="total_Cost"></span></td>
                    <td><span id="total_Hours"></span></td>
                    <td><form action="{{url_for('book_slot',company_id=company_id)}}" method="post" id="bookings">
                        <input type="text" name="selectedport" value="{{ selectedport }}" hidden>
                        <input type="text" name="selectedtype" value="{{ selectedtype }}" hidden>
                        <input type="text" name="selectedlevel" value="{{ selectedlevel }}" hidden>
                        <input type="text" name="startSlot" id="startSlot" hidden><br>
                        <input type="text" name="endSlot" id="endSlot" hidden>
                        <input type="text" name="totalCost" id="totalCost" hidden>
                        <input type="text" name="totalHours" id="totalHours" hidden>
                        <button name="submit" value="submit" type="submit" class="btn btn-danger btn-block btn-flat">Submit</button>
                    </form>
                    </td>
               
            </tbody>
        </table>
    </div>

    <script>
        // var booked_data = [
        //     ["00:00 - 00:15", "03:00 - 03:15"],
        //     ["10:30", "11:00"],
        //     // Add more booked slots as needed
        // ];
        var booked_data = {{ booked_data |safe}};

        var timeSlots = [
    "00:00 - 00:15",
    "00:15 - 00:30",
    "00:30 - 00:45",
    "00:45 - 01:00",
    "01:00 - 01:15",
    "01:15 - 01:30",
    "01:30 - 01:45",
    "01:45 - 02:00",
    "02:00 - 02:15",
    "02:15 - 02:30",
    "02:30 - 02:45",
    "02:45 - 03:00",
    "03:00 - 03:15",
    "03:15 - 03:30",
    "03:30 - 03:45",
    "03:45 - 04:00",
    "04:00 - 04:15",
    "04:15 - 04:30",
    "04:30 - 04:45",
    "04:45 - 05:00",
    "05:00 - 05:15",
    "05:15 - 05:30",
    "05:30 - 05:45",
    "05:45 - 06:00",
    "06:00 - 06:15",
    "06:15 - 06:30",
    "06:30 - 06:45",
    "06:45 - 07:00",
    "07:00 - 07:15",
    "07:15 - 07:30",
    "07:30 - 07:45",
    "07:45 - 08:00",
    "08:00 - 08:15",
    "08:15 - 08:30",
    "08:30 - 08:45",
    "08:45 - 09:00",
    "09:00 - 09:15",
    "09:15 - 09:30",
    "09:30 - 09:45",
    "09:45 - 10:00",
    "10:00 - 10:15",
    "10:15 - 10:30",
    "10:30 - 10:45",
    "10:45 - 11:00",
    "11:00 - 11:15",
    "11:15 - 11:30",
    "11:30 - 11:45",
    "11:45 - 12:00",
    "12:00 - 12:15",
    "12:15 - 12:30",
    "12:30 - 12:45",
    "12:45 - 13:00",
    "13:00 - 13:15",
    "13:15 - 13:30",
    "13:30 - 13:45",
    "13:45 - 14:00",
    "14:00 - 14:15",
    "14:15 - 14:30",
    "14:30 - 14:45",
    "14:45 - 15:00",
    "15:00 - 15:15",
    "15:15 - 15:30",
    "15:30 - 15:45",
    "15:45 - 16:00",
    "16:00 - 16:15",
    "16:15 - 16:30",
    "16:30 - 16:45",
    "16:45 - 17:00",
    "17:00 - 17:15",
    "17:15 - 17:30",
    "17:30 - 17:45",
    "17:45 - 18:00",
    "18:00 - 18:15",
    "18:15 - 18:30",
    "18:30 - 18:45",
    "18:45 - 19:00",
    "19:00 - 19:15",
    "19:15 - 19:30",
    "19:30 - 19:45",
    "19:45 - 20:00",
    "20:00 - 20:15",
    "20:15 - 20:30",
    "20:30 - 20:45",
    "20:45 - 21:00",
    "21:00 - 21:15",
    "21:15 - 21:30",
    "21:30 - 21:45",
    "21:45 - 22:00",
    "22:00 - 22:15",
    "22:15 - 22:30",
    "22:30 - 22:45",
    "22:45 - 23:00",
    "23:00 - 23:15",
    "23:15 - 23:30",
    "23:30 - 23:45",
    "23:45 - 24:00"
];

var selectedSlots = [];


        function createTimeSlots() {
            var container = document.getElementById("timeSlotsContainer");
            container.innerHTML = ""; // Clear previous content

            timeSlots.forEach(function(timeSlot) {
                var div = document.createElement("div");
                div.classList.add("time-slot");
                div.textContent = timeSlot;
                div.setAttribute("data-time", timeSlot);

                var isBooked = false;
                for (var i = 0; i < booked_data.length; i++) {
                    var startTime = booked_data[i][0];
                    var endTime = booked_data[i][1];
                    if (timeSlot >= startTime && timeSlot <= endTime) {
                        isBooked = true;
                        break;
                    }
                }

                if (isBooked) {
                    div.classList.add("booked");
                } else {
                    div.classList.add("available");
                }

                div.addEventListener("click", function() {
                    var currentIndex = timeSlots.indexOf(timeSlot);
                    var startSlotIndex = timeSlots.indexOf(selectedSlots[0]);
                    var endSlotIndex = timeSlots.indexOf(selectedSlots[selectedSlots.length - 1]);

                    if (!selectedSlots.length || (selectedSlots.length === 1 && selectedSlots[0] === timeSlot)) {
                        // If no slot is selected yet or the clicked slot is already selected
                        div.classList.add("selected");
                        selectedSlots = [timeSlot];
                    } else if (selectedSlots.length === 1) {
                        // If only one slot is selected
                        if (selectedSlots[0] === timeSlot) {
                            // If the same slot is clicked again
                            div.classList.remove("selected");
                            selectedSlots = [];
                        } else {
                            // If a different slot is clicked
                            var selectedSlotIndex = timeSlots.indexOf(selectedSlots[0]);
                            if (currentIndex < selectedSlotIndex) {
                                selectedSlots = timeSlots.slice(currentIndex, selectedSlotIndex + 1);
                            } else {
                                selectedSlots = timeSlots.slice(selectedSlotIndex, currentIndex + 1);
                            }
                            updateSlotsColor(startSlotIndex, endSlotIndex, false);
                            div.classList.add("selected");
                            updateSlotsColor(currentIndex, currentIndex, true);
                        }
                    } else {
                        // If multiple slots are selected
                        updateSlotsColor(startSlotIndex, endSlotIndex, false);
                        div.classList.add("selected");
                        selectedSlots = [timeSlot];
                    }

                    displaySelectedSlots();
                });

                container.appendChild(div);
            });
        }

        function displaySelectedSlots() {
            var selectedContainer = document.getElementById("selectedSlots");
            selectedContainer.innerHTML = "";
            if (selectedSlots.length > 0) {
                var selectedText = document.createElement("p");
                selectedText.textContent = "Selected Slots:";
                selectedContainer.appendChild(selectedText);

                selectedSlots.forEach(function(slot) {
                    var slotDiv = document.createElement("div");
                    slotDiv.textContent = slot;
                    selectedContainer.appendChild(slotDiv);
                });
            }

            // Update the start and end slot text boxes
            if (selectedSlots.length >= 2) {
                document.getElementById("startSlot").value = selectedSlots[0];
                document.getElementById("endSlot").value = selectedSlots[selectedSlots.length - 1];
                document.getElementById("selected_Range").innerHTML = selectedSlots[0] + selectedSlots[selectedSlots.length - 1];
                
                calculateTotalTime(selectedSlots[0], selectedSlots[selectedSlots.length - 1])
            } else {
                document.getElementById("startSlot").value = "";
                document.getElementById("endSlot").value = "";
            }
        }

        function updateSlotsColor(startIndex, endIndex, isSelected) {
            var slots = document.querySelectorAll(".time-slot");
            for (var i = startIndex; i <= endIndex; i++) {
                if (isSelected) {
                    slots[i].classList.add("selected");
                } else {
                    slots[i].classList.remove("selected");
                }
            }
           
        }

        

            function calculateTotalTime(startTime, endTime) {
                // document.getElementById('bookings').style.display="block";

                var startParts = startTime.split(':');
                var startMinutes = parseInt(startParts[0]) * 60 + parseInt(startParts[1]);
                

                var endParts = endTime.split(':');
                var endMinutes = parseInt(endParts[0]) * 60 + parseInt(endParts[1]);
                

                totalMinutes = endMinutes - startMinutes; // Update the global variable
    
                var hours = Math.floor(totalMinutes / 60);
                var minutes = totalMinutes % 60;
                
                var total_min = (hours*60)+minutes;

                
                totalcost = total_min * 1;
                



                
                document.getElementById("totalCost").value = totalcost + '  INR';
                document.getElementById("total_Cost").innerHTML = totalcost + '  INR';

                // document.getElementById('total_cost').value=totalcost;
                document.getElementById('totalHours').value =   hours + ' hours ' + minutes + ' minutes';
                document.getElementById('total_Hours').innerHTML =   hours + ' hours ' + minutes + ' minutes';
    
                return hours + ' hours ' + minutes + ' minutes';
            }

        window.onload = createTimeSlots;
    </script>
    {% include 'footer.html' %}
</body>
</html>

